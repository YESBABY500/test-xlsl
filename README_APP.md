# 电力分配仿真系统

基于Excel文件的严格表驱动桌面应用程序，用于实现电力分配逻辑仿真。

## 功能特性

- 严格验证所需的Excel文件和列名
- 自动导入和仿真（如果测试数据文件存在）
- PyQt5桌面GUI界面
- 支持可选规则文件加载
- 详细的错误消息和验证反馈

## 系统要求

- Python 3.7+
- 所需的Python包（见requirements.txt）

## 安装

1. 安装所需依赖：
```bash
pip install -r requirements.txt
```

## 使用方法

### 启动GUI应用程序
```bash
python app.py
```

### 命令行测试
```bash
python test_app.py    # 运行组件测试
python demo.py        # 运行完整流程演示
```

## 所需文件

应用程序需要以下Excel文件位于程序根目录：

### 必需文件
- **断面关系表.xlsx** - 断面映射关系
  - 必需列：断面编号, 断面名称, 点位
- **电站信息表.xlsx** - 电站信息
  - 必需列：电站编号, 电站名称, 出力, 点位
- **负荷信息表.xlsx** - 负荷用户信息
  - 必需列：用户编号, 用电用户, 负荷, 点位
- **导入数据（测试）.xlsx** - 测试数据和点位状态
  - 包含点位状态表格

### 可选文件
如果存在以下文件，将被自动加载：
- D站分配逻辑（11个）.xlsx
- T站分配逻辑（7个）.xlsx
- 分配逻辑-其他（13个）.xlsx
- 逻辑判断大用户（8个）.xlsx
- 直接挂接（41个）.xlsx
- 直接大用户（21个）.xlsx

## 应用程序行为

1. **启动时检查** - 应用程序启动时检查所需文件
2. **自动导入** - 如果导入数据（测试）.xlsx存在，自动运行导入和仿真
3. **严格验证** - 缺少必需文件或列时显示详细错误消息
4. **点位状态解析** - 支持两种格式：
   - 两列布局（点位, 状态）
   - 点位ID作为列名，第一行为状态值

## 错误处理

- 缺少必需文件：显示清晰的文件列表
- 缺少必需列：显示详细的列名差异
- 数据解析错误：提供具体的错误位置和原因

## 文件结构

```
├── app.py                    # 主应用程序GUI
├── data_loader.py           # Excel数据加载器
├── allocation_engine.py     # 分配逻辑引擎
├── test_app.py             # 组件测试
├── demo.py                 # 流程演示
├── requirements.txt        # Python依赖
└── README.md              # 说明文档
```

## 开发和调试

- 使用`test_app.py`验证组件功能
- 使用`demo.py`测试完整工作流程
- 检查控制台输出获取详细错误信息

## 注意事项

- Excel文件必须位于应用程序根目录
- 文件名必须完全匹配（包括中文字符）
- 应用程序设计为表驱动，严格依赖Excel文件结构
- 可选规则文件缺失不会阻止应用程序运行